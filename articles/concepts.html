<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data Lake Concepts â€¢ datapond</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data Lake Concepts">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">datapond</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/concepts.html">Data Lake Concepts</a></li>
    <li><a class="dropdown-item" href="../articles/code-walkthrough.html">Code Walkthrough</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CathalByrneGit/datapond/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Data Lake Concepts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CathalByrneGit/datapond/blob/main/vignettes/concepts.Rmd" class="external-link"><code>vignettes/concepts.Rmd</code></a></small>
      <div class="d-none name"><code>concepts.Rmd</code></div>
    </div>

    
    
<p>This vignette explains the core concepts behind <code>datapond</code>
- what data lakes are, how hive partitioning works, and what DuckLake
brings to the table. No prior knowledge assumed.</p>
<div class="section level2">
<h2 id="the-problem-were-solving">The Problem Weâ€™re Solving<a class="anchor" aria-label="anchor" href="#the-problem-were-solving"></a>
</h2>
<p>Within an organisation, different sections need to share data:</p>
<ul>
<li>
<strong>Trade</strong> produces import/export figures that
<strong>National Accounts</strong> needs</li>
<li>
<strong>Labour</strong> produces employment data that multiple
sections consume</li>
<li>
<strong>Health</strong> produces statistics that feed into other
analyses</li>
</ul>
<p>Currently, this happens through shared network drives with
folder-based access control. It works, but has limitations:</p>
<ul>
<li>No versioning (if someone overwrites a file, the old version is
gone)</li>
<li>No way to know when data changed or who changed it</li>
<li>Large files are slow to query (must read the whole thing)</li>
<li>No schema enforcement (columns can change without warning)</li>
</ul>
<p><code>datapond</code> addresses these issues while keeping the
familiar folder-and-permissions model that IT already supports.</p>
<hr>
</div>
<div class="section level2">
<h2 id="what-is-a-data-lake">What is a Data Lake?<a class="anchor" aria-label="anchor" href="#what-is-a-data-lake"></a>
</h2>
<p>A <strong>data lake</strong> is a storage system designed to hold
large amounts of structured data in files (typically Parquet format)
rather than in a traditional database.</p>
<pre><code>Traditional Database          Data Lake
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database       â”‚          â”‚  Files on disk  â”‚
â”‚  Server         â”‚          â”‚  (Parquet)      â”‚
â”‚                 â”‚          â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚  ğŸ“ Trade/      â”‚
â”‚  â”‚ Table A   â”‚  â”‚          â”‚    ğŸ“„ data.parquet
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚          â”‚  ğŸ“ Labour/     â”‚
â”‚  â”‚ Table B   â”‚  â”‚          â”‚    ğŸ“„ data.parquet
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“                              â†“
  Needs server               Just files!
  Needs DBA                  Query with DuckDB
  Licensing costs            Free &amp; fast</code></pre>
<p><strong>Why Parquet?</strong></p>
<p>Parquet is a columnar file format thatâ€™s:</p>
<ul>
<li>
<strong>Compressed</strong> - files are 5-10x smaller than CSV</li>
<li>
<strong>Fast</strong> - only reads the columns you need</li>
<li>
<strong>Typed</strong> - preserves data types (dates, numbers,
strings)</li>
<li>
<strong>Universal</strong> - works with R, Python, SAS, Excel, and
more</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="hive-partitioning-explained">Hive Partitioning Explained<a class="anchor" aria-label="anchor" href="#hive-partitioning-explained"></a>
</h2>
<p><strong>Hive partitioning</strong> is a way of organising files into
folders based on column values. The folder names encode the data they
contain.</p>
<div class="section level3">
<h3 id="example-trade-imports-data">Example: Trade Imports Data<a class="anchor" aria-label="anchor" href="#example-trade-imports-data"></a>
</h3>
<p>Instead of one massive file:</p>
<pre><code>Trade/Imports/all_data.parquet  (10 GB - slow to read!)</code></pre>
<p>We partition by year and month:</p>
<pre><code><span><span class="va">Trade</span><span class="op">/</span><span class="va">Imports</span><span class="op">/</span></span>
<span>  <span class="va">year</span><span class="op">=</span><span class="fl">2023</span><span class="op">/</span></span>
<span>    <span class="va">month</span><span class="op">=</span><span class="fl">01</span><span class="op">/</span></span>
<span>      <span class="va">data.parquet</span></span>
<span>      <span class="va">data_part2.parquet</span></span>
<span>    <span class="va">month</span><span class="op">=</span><span class="fl">02</span><span class="op">/</span></span>
<span>      <span class="va">data.parquet</span></span>
<span>    <span class="va">...</span></span>
<span>  <span class="va">year</span><span class="op">=</span><span class="fl">2024</span><span class="op">/</span></span>
<span>    <span class="va">month</span><span class="op">=</span><span class="fl">01</span><span class="op">/</span></span>
<span>      <span class="va">data.parquet</span></span>
<span>    <span class="va">...</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="why-this-matters">Why This Matters<a class="anchor" aria-label="anchor" href="#why-this-matters"></a>
</h3>
<p>When you query for January 2024 data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imports</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2024</span>, <span class="va">month</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>DuckDB is smart enough to <strong>only read the
<code>year=2024/month=01/</code> folder</strong>. It skips all other
folders entirely. This is called <strong>partition pruning</strong> and
it makes queries on large datasets dramatically faster.</p>
</div>
<div class="section level3">
<h3 id="choosing-partition-columns">Choosing Partition Columns<a class="anchor" aria-label="anchor" href="#choosing-partition-columns"></a>
</h3>
<p>Good partition columns are:</p>
<ul>
<li>
<strong>Low cardinality</strong> - not too many unique values (year,
month, region)</li>
<li>
<strong>Frequently filtered</strong> - columns you often use in
WHERE clauses</li>
<li>
<strong>Stable</strong> - values that donâ€™t change for existing
records</li>
</ul>
<p>Bad partition columns:</p>
<ul>
<li>
<strong>High cardinality</strong> - unique IDs, timestamps with
seconds</li>
<li>
<strong>Rarely filtered</strong> - columns you never filter on</li>
</ul>
<p><strong>Rule of thumb</strong>: Aim for partition folders containing
100MB - 1GB of data each.</p>
</div>
<div class="section level3">
<h3 id="how-datapond-uses-hive-partitioning">How datapond Uses Hive Partitioning<a class="anchor" aria-label="anchor" href="#how-datapond-uses-hive-partitioning"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write with partitioning</span></span>
<span><span class="fu"><a href="../reference/db_hive_write.html">db_hive_write</a></span><span class="op">(</span></span>
<span>  <span class="va">my_data</span>,</span>
<span>  section <span class="op">=</span> <span class="st">"Trade"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Imports"</span>,</span>
<span>  partition_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span>  <span class="co"># Creates year=X/month=Y folders</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read - partitions are automatic columns</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_hive_read.html">db_hive_read</a></span><span class="op">(</span><span class="st">"Trade"</span>, <span class="st">"Imports"</span><span class="op">)</span></span>
<span><span class="va">imports</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2024</span><span class="op">)</span>  <span class="co"># Only reads 2024 folders</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="what-is-ducklake">What is DuckLake?<a class="anchor" aria-label="anchor" href="#what-is-ducklake"></a>
</h2>
<p><strong>DuckLake</strong> is a newer approach that adds database-like
features on top of Parquet files. Think of it as â€œParquet files with
superpowersâ€.</p>
<pre><code>Hive Partitioning              DuckLake
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Just files      â”‚          â”‚ Files +         â”‚
â”‚                 â”‚          â”‚ Metadata catalogâ”‚
â”‚ ğŸ“ year=2024/   â”‚          â”‚                 â”‚
â”‚   ğŸ“„ data.parquet          â”‚ ğŸ“„ catalog.sqlite
â”‚                 â”‚          â”‚ ğŸ“ data/        â”‚
â”‚ No versioning   â”‚          â”‚   ğŸ“„ file1.parquet
â”‚ No transactions â”‚          â”‚   ğŸ“„ file2.parquet
â”‚                 â”‚          â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ âœ… Versioning   â”‚
                             â”‚ âœ… Transactions â”‚
                             â”‚ âœ… Time travel  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<div class="section level3">
<h3 id="the-metadata-catalog">The Metadata Catalog<a class="anchor" aria-label="anchor" href="#the-metadata-catalog"></a>
</h3>
<p>DuckLake needs a place to store metadata about your tables. This
<strong>catalog</strong> tracks:</p>
<ul>
<li>Which Parquet files belong to which table</li>
<li>The schema (columns and types) of each table</li>
<li>A history of all changes (snapshots)</li>
<li>Who made changes and when</li>
</ul>
<p>The actual data is still in Parquet files - DuckLake just adds a
management layer.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="choosing-a-catalog-backend">Choosing a Catalog Backend<a class="anchor" aria-label="anchor" href="#choosing-a-catalog-backend"></a>
</h2>
<p>DuckLake supports three different backends for storing this catalog
metadata:</p>
<div class="section level3">
<h3 id="duckdb-single-user">1. DuckDB (Single User)<a class="anchor" aria-label="anchor" href="#duckdb-single-user"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_lake_connect.html">db_lake_connect</a></span><span class="op">(</span></span>
<span>  catalog_type <span class="op">=</span> <span class="st">"duckdb"</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="st">"metadata.ducklake"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Metadata stored in a <code>.ducklake</code> file</li>
<li>
<strong>Single client only</strong> - if two people connect, one
will fail</li>
<li>Good for: personal use, development, testing</li>
</ul>
</div>
<div class="section level3">
<h3 id="sqlite-multiple-local-users---recommended">2. SQLite (Multiple Local Users) - RECOMMENDED<a class="anchor" aria-label="anchor" href="#sqlite-multiple-local-users---recommended"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_lake_connect.html">db_lake_connect</a></span><span class="op">(</span></span>
<span>  catalog_type <span class="op">=</span> <span class="st">"sqlite"</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/catalog.sqlite"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Metadata stored in a <code>.sqlite</code> file on the network
drive</li>
<li>
<strong>Multiple readers + single writer</strong> with automatic
retry</li>
<li>Still just a file - no server needed</li>
<li>Good for: <strong>shared network drives, most use
cases</strong>
</li>
</ul>
<p><strong>How SQLite handles concurrency:</strong></p>
<p>When someone is writing, other writers will wait and retry
automatically. Readers can continue uninterrupted. This works well for
typical usage where writes are less frequent than reads.</p>
</div>
<div class="section level3">
<h3 id="postgresql-multi-user-lakehouse">3. PostgreSQL (Multi-User Lakehouse)<a class="anchor" aria-label="anchor" href="#postgresql-multi-user-lakehouse"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_lake_connect.html">db_lake_connect</a></span><span class="op">(</span></span>
<span>  catalog_type <span class="op">=</span> <span class="st">"postgres"</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="st">"dbname=ducklake_catalog host=db.cso.ie"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/data"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Metadata stored in a PostgreSQL database</li>
<li>
<strong>Full concurrent access</strong> - multiple readers and
writers</li>
<li>Requires PostgreSQL 12+ server</li>
<li>Good for: large teams, high write concurrency, remote access</li>
</ul>
</div>
<div class="section level3">
<h3 id="which-should-you-choose">Which Should You Choose?<a class="anchor" aria-label="anchor" href="#which-should-you-choose"></a>
</h3>
<pre><code>Are you the only user?
  â””â”€ Yes â†’ DuckDB (simplest)
  â””â”€ No â†’ Are you on a shared network drive?
            â””â”€ Yes â†’ SQLite (recommended)
            â””â”€ No â†’ Do you need high write concurrency?
                      â””â”€ Yes â†’ PostgreSQL
                      â””â”€ No â†’ SQLite</code></pre>
<p><strong>For most use cases, start with SQLite.</strong> Itâ€™s still
just a file (familiar, works with IT permissions), but handles multiple
users gracefully.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="key-ducklake-features">Key DuckLake Features<a class="anchor" aria-label="anchor" href="#key-ducklake-features"></a>
</h2>
<div class="section level3">
<h3 id="time-travel">1. Time Travel<a class="anchor" aria-label="anchor" href="#time-travel"></a>
</h3>
<p>Query data as it existed at any point in the past:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Current data</span></span>
<span><span class="va">products</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_lake_read.html">db_lake_read</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"products"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data as of version 5</span></span>
<span><span class="va">products_v5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_lake_read.html">db_lake_read</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"products"</span>, version <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data as of last Tuesday</span></span>
<span><span class="va">products_tue</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_lake_read.html">db_lake_read</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">"products"</span>, </span>
<span>                              timestamp <span class="op">=</span> <span class="st">"2025-01-14 00:00:00"</span><span class="op">)</span></span></code></pre></div>
<p>This is invaluable when:</p>
<ul>
<li>Someone reports â€œthe numbers looked different yesterdayâ€ - you can
check!</li>
<li>You need to reproduce an analysis from a specific date</li>
<li>Something went wrong and you need to see the before/after</li>
</ul>
</div>
<div class="section level3">
<h3 id="snapshots-and-audit-trail">2. Snapshots and Audit Trail<a class="anchor" aria-label="anchor" href="#snapshots-and-audit-trail"></a>
</h3>
<p>Every change creates a new <strong>snapshot</strong> with
metadata:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_snapshots.html">db_snapshots</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   snapshot_id snapshot_time       commit_author commit_message</span></span>
<span><span class="co">#&gt; 1           1 2025-01-01 09:00:00 jsmith        Initial load</span></span>
<span><span class="co">#&gt; 2           2 2025-01-15 14:30:00 mjones        Added Q4 data</span></span>
<span><span class="co">#&gt; 3           3 2025-01-20 11:00:00 mjones        Fixed country codes</span></span></code></pre></div>
<p>You always know what changed, when, and (if recorded) why.</p>
</div>
<div class="section level3">
<h3 id="acid-transactions">3. ACID Transactions<a class="anchor" aria-label="anchor" href="#acid-transactions"></a>
</h3>
<p>Changes are <strong>atomic</strong> - they either fully succeed or
fully fail. No partial updates that leave data in a broken state.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If this fails halfway through, no data is changed</span></span>
<span><span class="fu"><a href="../reference/db_lake_write.html">db_lake_write</a></span><span class="op">(</span><span class="va">big_dataset</span>, table <span class="op">=</span> <span class="st">"imports"</span>, mode <span class="op">=</span> <span class="st">"overwrite"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="schema-evolution">4. Schema Evolution<a class="anchor" aria-label="anchor" href="#schema-evolution"></a>
</h3>
<p>DuckLake handles schema changes gracefully:</p>
<ul>
<li>Add a new column? Old data gets NULLs for that column</li>
<li>Query old versions? They still work with the old schema</li>
</ul>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="schemas-organising-tables">Schemas: Organising Tables<a class="anchor" aria-label="anchor" href="#schemas-organising-tables"></a>
</h2>
<p>In DuckLake, <strong>schemas</strong> are like folders for tables.
They help organise related tables together.</p>
<pre><code>catalog (datapond)
â”œâ”€â”€ main (default schema)
â”‚   â””â”€â”€ reference_tables
â”œâ”€â”€ trade
â”‚   â”œâ”€â”€ imports
â”‚   â”œâ”€â”€ exports
â”‚   â””â”€â”€ products
â”œâ”€â”€ labour
â”‚   â”œâ”€â”€ employment
â”‚   â””â”€â”€ earnings
â””â”€â”€ health
    â”œâ”€â”€ hospitals
    â””â”€â”€ waiting_times</code></pre>
<div class="section level3">
<h3 id="using-schemas">Using Schemas<a class="anchor" aria-label="anchor" href="#using-schemas"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a schema for your section</span></span>
<span><span class="fu"><a href="../reference/db_create_schema.html">db_create_schema</a></span><span class="op">(</span><span class="st">"trade"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write to it</span></span>
<span><span class="fu"><a href="../reference/db_lake_write.html">db_lake_write</a></span><span class="op">(</span><span class="va">imports_data</span>, schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read from it</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_lake_read.html">db_lake_read</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># List tables in a schema</span></span>
<span><span class="fu"><a href="../reference/db_list_tables.html">db_list_tables</a></span><span class="op">(</span><span class="st">"trade"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="schemas-vs-sections">Schemas vs Sections<a class="anchor" aria-label="anchor" href="#schemas-vs-sections"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Hive Mode</th>
<th>DuckLake Mode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Section (folder)</td>
<td>Schema</td>
</tr>
<tr class="even">
<td>Dataset (subfolder)</td>
<td>Table</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/db_list_sections.html">db_list_sections()</a></code></td>
<td><code><a href="../reference/db_list_schemas.html">db_list_schemas()</a></code></td>
</tr>
<tr class="even">
<td><code>db_list_datasets("Trade")</code></td>
<td><code>db_list_tables("trade")</code></td>
</tr>
</tbody>
</table>
<p>They serve the same organisational purpose - grouping related data
together.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="data-documentation">Data Documentation<a class="anchor" aria-label="anchor" href="#data-documentation"></a>
</h2>
<p>Good data governance requires documentation. <code>datapond</code>
provides built-in tools to document your datasets and generate a data
dictionary.</p>
<div class="section level3">
<h3 id="documenting-datasets">Documenting Datasets<a class="anchor" aria-label="anchor" href="#documenting-datasets"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add metadata to a dataset</span></span>
<span><span class="fu"><a href="../reference/db_describe.html">db_describe</a></span><span class="op">(</span></span>
<span>  section <span class="op">=</span> <span class="st">"Trade"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Imports"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Monthly import values by country and HS commodity code"</span>,</span>
<span>  owner <span class="op">=</span> <span class="st">"Trade Section"</span>,</span>
<span>  tags <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trade"</span>, <span class="st">"monthly"</span>, <span class="st">"official"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Document individual columns</span></span>
<span><span class="fu"><a href="../reference/db_describe_column.html">db_describe_column</a></span><span class="op">(</span></span>
<span>  section <span class="op">=</span> <span class="st">"Trade"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Imports"</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Import value"</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"EUR (thousands)"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/db_describe_column.html">db_describe_column</a></span><span class="op">(</span></span>
<span>  section <span class="op">=</span> <span class="st">"Trade"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Imports"</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"country_code"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"ISO 3166-1 alpha-2 country code"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="where-is-documentation-stored">Where is Documentation Stored?<a class="anchor" aria-label="anchor" href="#where-is-documentation-stored"></a>
</h3>
<ul>
<li>
<strong>Hive mode</strong>: Creates a <code>_metadata.json</code>
file in each dataset folder</li>
<li>
<strong>DuckLake mode</strong>: Stores in a <code>_metadata</code>
schema in the catalog</li>
</ul>
<p>Either way, documentation travels with the data.</p>
</div>
<div class="section level3">
<h3 id="searching-and-discovery">Searching and Discovery<a class="anchor" aria-label="anchor" href="#searching-and-discovery"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Search datasets by any field</span></span>
<span><span class="fu"><a href="../reference/db_search.html">db_search</a></span><span class="op">(</span><span class="st">"trade"</span><span class="op">)</span>                        <span class="co"># Matches name, description, owner, or tags</span></span>
<span><span class="fu"><a href="../reference/db_search.html">db_search</a></span><span class="op">(</span><span class="st">"monthly"</span>, field <span class="op">=</span> <span class="st">"tags"</span><span class="op">)</span>      <span class="co"># Search only tags</span></span>
<span><span class="fu"><a href="../reference/db_search.html">db_search</a></span><span class="op">(</span><span class="st">"Trade Section"</span>, field <span class="op">=</span> <span class="st">"owner"</span><span class="op">)</span>  <span class="co"># Find datasets by owner</span></span>
<span></span>
<span><span class="co"># Find columns across all datasets</span></span>
<span><span class="fu"><a href="../reference/db_search_columns.html">db_search_columns</a></span><span class="op">(</span><span class="st">"country"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   section  dataset  column_name  column_type  column_description</span></span>
<span><span class="co">#&gt; 1 Trade    Imports  country_code VARCHAR      ISO 3166-1 alpha-2...</span></span>
<span><span class="co">#&gt; 2 Trade    Exports  country_code VARCHAR      ISO 3166-1 alpha-2...</span></span>
<span><span class="co">#&gt; 3 Labour   Survey   country      VARCHAR      Country of residence</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generating-a-data-dictionary">Generating a Data Dictionary<a class="anchor" aria-label="anchor" href="#generating-a-data-dictionary"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Full data dictionary with column details</span></span>
<span><span class="va">dict</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_dictionary.html">db_dictionary</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Just dataset-level summary</span></span>
<span><span class="va">dict_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_dictionary.html">db_dictionary</a></span><span class="op">(</span>include_columns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter to specific section</span></span>
<span><span class="va">dict_trade</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_dictionary.html">db_dictionary</a></span><span class="op">(</span>section <span class="op">=</span> <span class="st">"Trade"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export to Excel</span></span>
<span><span class="fu">writexl</span><span class="fu">::</span><span class="fu">write_xlsx</span><span class="op">(</span><span class="va">dict</span>, <span class="st">"data_dictionary.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>The data dictionary includes: - Dataset/table name and location -
Description, owner, tags - Column names, types, and documentation - Last
updated timestamps</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="preview-before-writing">Preview Before Writing<a class="anchor" aria-label="anchor" href="#preview-before-writing"></a>
</h2>
<p>Before making changes to production data, you can preview what will
happen:</p>
<div class="section level3">
<h3 id="hive-write-preview">Hive Write Preview<a class="anchor" aria-label="anchor" href="#hive-write-preview"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_preview_hive_write.html">db_preview_hive_write</a></span><span class="op">(</span></span>
<span>  <span class="va">my_data</span>,</span>
<span>  section <span class="op">=</span> <span class="st">"Trade"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Imports"</span>,</span>
<span>  partition_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"replace_partitions"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Shows: - Target path and whether it exists - Incoming vs existing row
counts - <strong>Schema changes</strong> - new columns, removed columns,
type changes - <strong>Partition impact</strong> - which partitions will
be affected</p>
</div>
<div class="section level3">
<h3 id="ducklake-write-preview">DuckLake Write Preview<a class="anchor" aria-label="anchor" href="#ducklake-write-preview"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_preview_lake_write.html">db_preview_lake_write</a></span><span class="op">(</span><span class="va">my_data</span>, table <span class="op">=</span> <span class="st">"imports"</span>, mode <span class="op">=</span> <span class="st">"overwrite"</span><span class="op">)</span></span></code></pre></div>
<p>Shows: - Current vs new row counts - Schema comparison - Warnings
(e.g., append to non-existent table)</p>
</div>
<div class="section level3">
<h3 id="upsert-preview">Upsert Preview<a class="anchor" aria-label="anchor" href="#upsert-preview"></a>
</h3>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/db_preview_upsert.html">db_preview_upsert</a></span><span class="op">(</span><span class="va">my_data</span>, table <span class="op">=</span> <span class="st">"products"</span>, by <span class="op">=</span> <span class="st">"product_id"</span><span class="op">)</span></span></code></pre></div>
<p>Shows: - How many rows will be <strong>inserted</strong> (new keys) -
How many rows will be <strong>updated</strong> (existing keys) -
Warnings about duplicate keys in incoming data</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparing-the-two-approaches">Comparing the Two Approaches<a class="anchor" aria-label="anchor" href="#comparing-the-two-approaches"></a>
</h2>
<div class="section level3">
<h3 id="when-to-use-hive-mode">When to Use Hive Mode<a class="anchor" aria-label="anchor" href="#when-to-use-hive-mode"></a>
</h3>
<p>âœ… <strong>Good for:</strong></p>
<ul>
<li>Migrating from existing SAS folder structure</li>
<li>Simple data sharing without versioning needs</li>
<li>When you need direct file access (for tools that canâ€™t use
DuckLake)</li>
<li>Getting started quickly with minimal setup</li>
</ul>
<p>âŒ <strong>Limitations:</strong></p>
<ul>
<li>No versioning - overwrites are permanent</li>
<li>No transaction safety - partial failures can corrupt data</li>
<li>Manual schema management</li>
</ul>
</div>
<div class="section level3">
<h3 id="when-to-use-ducklake-mode">When to Use DuckLake Mode<a class="anchor" aria-label="anchor" href="#when-to-use-ducklake-mode"></a>
</h3>
<p>âœ… <strong>Good for:</strong></p>
<ul>
<li>Production data pipelines where reliability matters</li>
<li>When you need audit trails (who changed what, when)</li>
<li>Analyses that need to be reproducible at specific points in
time</li>
<li>Complex updates (upserts, merges)</li>
</ul>
<p>âŒ <strong>Considerations:</strong></p>
<ul>
<li>Slightly more complex setup (choose catalog backend)</li>
<li>Newer technology (less battle-tested than simple files)</li>
</ul>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="access-control">Access Control<a class="anchor" aria-label="anchor" href="#access-control"></a>
</h2>
<p>Both modes use <strong>file system permissions</strong> - the same
model commonly used.</p>
<div class="section level3">
<h3 id="hive-mode-access">Hive Mode Access<a class="anchor" aria-label="anchor" href="#hive-mode-access"></a>
</h3>
<pre><code>//CSO-NAS/DataLake/
â”œâ”€â”€ Trade/          â† Trade section has read/write
â”‚   â”œâ”€â”€ Imports/
â”‚   â””â”€â”€ Exports/
â”œâ”€â”€ Labour/         â† Labour section has read/write
â”‚   â””â”€â”€ Employment/
â””â”€â”€ Shared/         â† Everyone has read access
    â””â”€â”€ Reference/</code></pre>
<p>Users get access by being granted folder permissions through IT.</p>
</div>
<div class="section level3">
<h3 id="ducklake-mode-access">DuckLake Mode Access<a class="anchor" aria-label="anchor" href="#ducklake-mode-access"></a>
</h3>
<pre><code>//CSO-NAS/DataLake/
â”œâ”€â”€ catalog.sqlite      â† Need read (or read/write) access
â””â”€â”€ data/               â† Need read (or read/write) access
    â”œâ”€â”€ trade/
    â””â”€â”€ labour/</code></pre>
<p><strong>Read access</strong> = can query data <strong>Write
access</strong> = can modify data</p>
<p>The permissions work at the file/folder level, just like before.</p>
<p>For PostgreSQL catalogs, youâ€™d also need database credentials - but
the Parquet data files still use file system permissions.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="public-catalog-organisation-wide-discovery">Public Catalog: Organisation-wide Discovery<a class="anchor" aria-label="anchor" href="#public-catalog-organisation-wide-discovery"></a>
</h2>
<p>A common challenge: <strong>How do people discover what data exists
without having access to all of it?</strong></p>
<p>In Hive mode, if you canâ€™t access the Trade folder, you canâ€™t see
what datasets Trade has. <code>datapond</code> solves this with a
<strong>public catalog</strong> - a shared location for metadata
only.</p>
<div class="section level3">
<h3 id="how-it-works">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h3>
<pre><code>//CSO-NAS/DataLake/
â”œâ”€â”€ _catalog/             â† Everyone can read this folder
â”‚   â”œâ”€â”€ Trade/
â”‚   â”‚   â”œâ”€â”€ Imports.json  â† Metadata only (description, owner, columns)
â”‚   â”‚   â””â”€â”€ Exports.json
â”‚   â””â”€â”€ Labour/
â”‚       â””â”€â”€ Employment.json
â”œâ”€â”€ Trade/                â† Only Trade section can access
â”‚   â””â”€â”€ Imports/
â”‚       â”œâ”€â”€ _metadata.json â† Source metadata
â”‚       â””â”€â”€ year=2024/
â”‚           â””â”€â”€ data.parquet
â””â”€â”€ Labour/               â† Only Labour section can access
    â””â”€â”€ Employment/</code></pre>
</div>
<div class="section level3">
<h3 id="publishing-to-the-public-catalog">Publishing to the Public Catalog<a class="anchor" aria-label="anchor" href="#publishing-to-the-public-catalog"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Make a dataset discoverable</span></span>
<span><span class="fu"><a href="../reference/db_describe.html">db_describe</a></span><span class="op">(</span></span>
<span>  section <span class="op">=</span> <span class="st">"Trade"</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"Imports"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Monthly import values by country"</span>,</span>
<span>  owner <span class="op">=</span> <span class="st">"Trade Section"</span>,</span>
<span>  public <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Copies metadata to _catalog/Trade/Imports.json</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use the convenience function</span></span>
<span><span class="fu"><a href="../reference/db_set_public.html">db_set_public</a></span><span class="op">(</span>section <span class="op">=</span> <span class="st">"Trade"</span>, dataset <span class="op">=</span> <span class="st">"Imports"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="discovering-data">Discovering Data<a class="anchor" aria-label="anchor" href="#discovering-data"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Anyone can see what datasets exist (even without data access)</span></span>
<span><span class="fu"><a href="../reference/db_list_public.html">db_list_public</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   section dataset            description        owner</span></span>
<span><span class="co">#&gt; 1   Trade Imports Monthly import values  Trade Section</span></span>
<span><span class="co">#&gt; 2  Labour Employment    Employment stats Labour Section</span></span>
<span></span>
<span><span class="co"># Find datasets by keyword</span></span>
<span><span class="fu"><a href="../reference/db_search.html">db_search</a></span><span class="op">(</span><span class="st">"monthly"</span>, field <span class="op">=</span> <span class="st">"description"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="security-model">Security Model<a class="anchor" aria-label="anchor" href="#security-model"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>Location</th>
<th>Contains</th>
<th>Who Can Access</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>_catalog/</code></td>
<td>Metadata only (JSON)</td>
<td>Everyone (read)</td>
</tr>
<tr class="even">
<td><code>Trade/</code></td>
<td>Actual data (Parquet)</td>
<td>Trade section only</td>
</tr>
</tbody>
</table>
<p><strong>The data stays secure</strong> - the public catalog only
contains descriptions, not the actual data values.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="ducklake-access-control">DuckLake Access Control<a class="anchor" aria-label="anchor" href="#ducklake-access-control"></a>
</h2>
<p>DuckLake <strong>automatically organises data</strong> into
<code>{schema}/{table}/</code> folder structure, enabling folder-level
permissions without any extra configuration.</p>
<div class="section level3">
<h3 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a>
</h3>
<pre><code>//CSO-NAS/DataLake/
â”œâ”€â”€ catalog.sqlite           â† Single DuckLake catalog
â””â”€â”€ data/                    â† Data organised automatically by schema/table
    â”œâ”€â”€ trade/               â† Trade team has access (folder ACLs)
    â”‚   â”œâ”€â”€ imports/
    â”‚   â”‚   â””â”€â”€ ducklake-uuid.parquet
    â”‚   â””â”€â”€ exports/
    â”‚       â””â”€â”€ ducklake-uuid.parquet
    â”œâ”€â”€ labour/              â† Labour team has access (folder ACLs)
    â”‚   â””â”€â”€ employment/
    â”‚       â””â”€â”€ ducklake-uuid.parquet
    â””â”€â”€ reference/           â† Everyone has read access
        â””â”€â”€ countries/
            â””â”€â”€ ducklake-uuid.parquet</code></pre>
</div>
<div class="section level3">
<h3 id="setting-up-schemas">Setting Up Schemas<a class="anchor" aria-label="anchor" href="#setting-up-schemas"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connect to DuckLake</span></span>
<span><span class="fu"><a href="../reference/db_lake_connect.html">db_lake_connect</a></span><span class="op">(</span></span>
<span>  catalog_type <span class="op">=</span> <span class="st">"sqlite"</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/catalog.sqlite"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create schemas - DuckLake creates folders automatically</span></span>
<span><span class="fu"><a href="../reference/db_create_schema.html">db_create_schema</a></span><span class="op">(</span><span class="st">"trade"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_create_schema.html">db_create_schema</a></span><span class="op">(</span><span class="st">"labour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_create_schema.html">db_create_schema</a></span><span class="op">(</span><span class="st">"reference"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Write data - files go to data/{schema}/{table}/ automatically</span></span>
<span><span class="fu"><a href="../reference/db_lake_write.html">db_lake_write</a></span><span class="op">(</span><span class="va">imports_data</span>, schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_lake_write.html">db_lake_write</a></span><span class="op">(</span><span class="va">countries</span>, schema <span class="op">=</span> <span class="st">"reference"</span>, table <span class="op">=</span> <span class="st">"countries"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set folder ACLs on the schema folders:</span></span>
<span><span class="co"># - //CSO-NAS/DataLake/data/trade/     â†’ Trade team read/write</span></span>
<span><span class="co"># - //CSO-NAS/DataLake/data/labour/    â†’ Labour team read/write</span></span>
<span><span class="co"># - //CSO-NAS/DataLake/data/reference/ â†’ Everyone read</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="using-schemas-1">Using Schemas<a class="anchor" aria-label="anchor" href="#using-schemas-1"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read from a schema (requires folder access)</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_lake_read.html">db_lake_read</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Discover available tables</span></span>
<span><span class="fu"><a href="../reference/db_list_schemas.html">db_list_schemas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_list_tables.html">db_list_tables</a></span><span class="op">(</span><span class="st">"trade"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Optionally partition for finer access control</span></span>
<span><span class="fu"><a href="../reference/db_set_partitioning.html">db_set_partitioning</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span>, partition_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_get_partitioning.html">db_get_partitioning</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="how-it-works-1">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="34%">
<col width="65%">
</colgroup>
<thead><tr class="header">
<th>Component</th>
<th>Access Controlled By</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Catalog file (<code>.sqlite</code>)</td>
<td>File permissions - need read to query, write to modify</td>
</tr>
<tr class="even">
<td>Schema data folder</td>
<td>Folder ACLs - each schema can have different permissions</td>
</tr>
<tr class="odd">
<td>Table data</td>
<td>Inherited from schema folder</td>
</tr>
</tbody>
</table>
<p><strong>Benefits</strong>: - <strong>Zero configuration</strong> -
folder structure created automatically - <strong>Familiar model</strong>
- uses standard folder permissions - <strong>Granular control</strong> -
different teams can own different schemas - <strong>Single
catalog</strong> - one metadata file, simpler management -
<strong>IT-friendly</strong> - works with existing permission
infrastructure</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="putting-it-together">Putting It Together<a class="anchor" aria-label="anchor" href="#putting-it-together"></a>
</h2>
<p>Hereâ€™s how a typical workflow might look:</p>
<div class="section level3">
<h3 id="publishing-data-producer">Publishing Data (Producer)<a class="anchor" aria-label="anchor" href="#publishing-data-producer"></a>
</h3>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CathalByrneGit/datapond" class="external-link">datapond</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to DuckLake</span></span>
<span><span class="fu"><a href="../reference/db_lake_connect.html">db_lake_connect</a></span><span class="op">(</span></span>
<span>  catalog_type <span class="op">=</span> <span class="st">"sqlite"</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/catalog.sqlite"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare your data</span></span>
<span><span class="va">imports_q1</span> <span class="op">&lt;-</span> <span class="fu">prepare_imports_data</span><span class="op">(</span><span class="va">raw_files</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preview what will happen</span></span>
<span><span class="fu"><a href="../reference/db_preview_lake_write.html">db_preview_lake_write</a></span><span class="op">(</span><span class="va">imports_q1</span>, schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span>, mode <span class="op">=</span> <span class="st">"append"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Publish with a meaningful commit message</span></span>
<span><span class="fu"><a href="../reference/db_lake_write.html">db_lake_write</a></span><span class="op">(</span></span>
<span>  <span class="va">imports_q1</span>,</span>
<span>  schema <span class="op">=</span> <span class="st">"trade"</span>,</span>
<span>  table <span class="op">=</span> <span class="st">"imports"</span>,</span>
<span>  mode <span class="op">=</span> <span class="st">"append"</span>,</span>
<span>  commit_author <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.info.html" class="external-link">Sys.info</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">"user"</span><span class="op">]</span>,</span>
<span>  commit_message <span class="op">=</span> <span class="st">"Q1 2025 imports data - final"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Document for discovery</span></span>
<span><span class="fu"><a href="../reference/db_describe.html">db_describe</a></span><span class="op">(</span></span>
<span>  schema <span class="op">=</span> <span class="st">"trade"</span>,</span>
<span>  table <span class="op">=</span> <span class="st">"imports"</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Monthly import values by country and HS code"</span>,</span>
<span>  owner <span class="op">=</span> <span class="st">"Trade Section"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/db_disconnect.html">db_disconnect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="consuming-data-consumer">Consuming Data (Consumer)<a class="anchor" aria-label="anchor" href="#consuming-data-consumer"></a>
</h3>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CathalByrneGit/datapond" class="external-link">datapond</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to DuckLake (read access to catalog and data folder)</span></span>
<span><span class="fu"><a href="../reference/db_lake_connect.html">db_lake_connect</a></span><span class="op">(</span></span>
<span>  catalog_type <span class="op">=</span> <span class="st">"sqlite"</span>,</span>
<span>  metadata_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/catalog.sqlite"</span>,</span>
<span>  data_path <span class="op">=</span> <span class="st">"//CSO-NAS/DataLake/data"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Discover what's available</span></span>
<span><span class="fu"><a href="../reference/db_list_schemas.html">db_list_schemas</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/db_list_tables.html">db_list_tables</a></span><span class="op">(</span><span class="st">"trade"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Search for relevant data</span></span>
<span><span class="fu"><a href="../reference/db_search.html">db_search</a></span><span class="op">(</span><span class="st">"imports"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check documentation</span></span>
<span><span class="fu"><a href="../reference/db_get_docs.html">db_get_docs</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read and analyse</span></span>
<span><span class="va">imports</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_lake_read.html">db_lake_read</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="st">"trade"</span>, table <span class="op">=</span> <span class="st">"imports"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">imports</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2025</span>, <span class="va">quarter</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>total_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">collect</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/db_disconnect.html">db_disconnect</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="glossary">Glossary<a class="anchor" aria-label="anchor" href="#glossary"></a>
</h2>
<table class="table">
<colgroup>
<col width="40%">
<col width="60%">
</colgroup>
<thead><tr class="header">
<th>Term</th>
<th>Meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Parquet</strong></td>
<td>Columnar file format for storing tabular data efficiently</td>
</tr>
<tr class="even">
<td><strong>Hive partitioning</strong></td>
<td>Organising files into folders named by column values (e.g.,
<code>year=2024/</code>)</td>
</tr>
<tr class="odd">
<td><strong>Partition pruning</strong></td>
<td>Query optimisation that skips irrelevant partition folders</td>
</tr>
<tr class="even">
<td><strong>DuckLake</strong></td>
<td>Metadata layer that adds versioning and transactions to Parquet
files</td>
</tr>
<tr class="odd">
<td><strong>Catalog</strong></td>
<td>Database storing DuckLake metadata (can be DuckDB, SQLite, or
PostgreSQL)</td>
</tr>
<tr class="even">
<td><strong>Snapshot</strong></td>
<td>A point-in-time version of the data in DuckLake</td>
</tr>
<tr class="odd">
<td><strong>Time travel</strong></td>
<td>Querying data as it existed at a past version or timestamp</td>
</tr>
<tr class="even">
<td><strong>Schema</strong></td>
<td>A namespace for organising related tables; can have custom data
paths for access control</td>
</tr>
<tr class="odd">
<td><strong>Schema path</strong></td>
<td>Custom data folder for a DuckLake schema, enabling folder-based
access control</td>
</tr>
<tr class="even">
<td><strong>ACID</strong></td>
<td>Atomicity, Consistency, Isolation, Durability - database reliability
guarantees</td>
</tr>
<tr class="odd">
<td><strong>Upsert</strong></td>
<td>Update existing rows + insert new rows in one operation</td>
</tr>
<tr class="even">
<td><strong>Data dictionary</strong></td>
<td>Documentation of all datasets, their columns, types, and
descriptions</td>
</tr>
<tr class="odd">
<td><strong>Public catalog</strong></td>
<td>Shared location for metadata in hive mode, enabling discovery
without data access</td>
</tr>
<tr class="even">
<td><strong>Section</strong></td>
<td>An organisational unit (e.g., Trade, Labour) - folder in hive
mode</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<ul>
<li>See <code><a href="../articles/code-walkthrough.html">vignette("code-walkthrough")</a></code> for detailed
explanation of how the package code works</li>
<li>Try the examples in the README to get hands-on experience</li>
<li>Start with Hive mode if migrating from SAS, move to DuckLake when
ready</li>
<li>For DuckLake, use SQLite catalog on shared drives</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Cathal Byrne.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
